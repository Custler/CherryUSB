Как написать портирование (Porting)
==============================

Этот раздел основно посвящен тому, как выполнить портирование для чипов, которые не поддерживаются.

Портирование для устройства (Slave)
----------------------------

- Сначала создайте копию файла `usb_dc.c` из директории `port/template` и убедитесь, что он компилируется без ошибок.
- Реализуйте функцию ``usb_dc_init`` так, чтобы она могла войти в прерывание.
- В обработчике прерывания проверьте сброс (reset) и убедитесь, что прерывание по сбросу корректно срабатывает. В этом прерывании вызовите ``usbd_event_reset_handler``. Если это возможно, начните чтение setup-пакета.
- В обработчике прерывания проверьте прерывание setup и убедитесь, что оно корректно срабатывает, затем передайте прочитанные данные в ``usbd_event_ep0_setup_complete_handler``.
- Реализуйте функцию ``usbd_ep_start_write`` так, чтобы она могла срабатывать по завершении отправки.
- Реализуйте функцию ``usbd_ep_start_read`` так, чтобы она могла срабатывать по завершении приема.
- Обработка разбиения на подпакеты (fragmentation).

Портирование для хоста (Host)
----------------------------

- Сначала создайте копию файла `usb_hc.c` из директории `port/template` и убедитесь, что он компилируется без ошибок.
- Реализуйте функцию ``usb_hc_init`` так, чтобы она могла войти в прерывание.
- Убедитесь, что можно войти в прерывание по подключению и отключению, например, ``connect`` и ``disconnect``, и что вызов ``usbh_roothub_thread_wakeup`` пробуждает поток хаба.
- Реализуйте функцию ``usbh_roothub_control`` и, исходя из третьего условия, завершите процесс, который предшествует ``usbh_enumerate`` в ``usbh_hub_events``.
- Реализуйте функцию ``usbh_submit_urb``.
